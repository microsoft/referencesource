<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">
  <PropertyGroup>
    <ProjectGuid>{3A615412-F349-4E0C-839C-89FC23EF0CCE}</ProjectGuid>
    <SccProjectName>SAK</SccProjectName>
    <SccLocalPath>SAK</SccLocalPath>
    <SccAuxPath>SAK</SccAuxPath>
    <SccProvider>SAK</SccProvider>
  </PropertyGroup>
  <!-- Need to use $(_NTROOT) to detect Razzle since $(RazzleBuild) isn't defined yet. -->
  <PropertyGroup Condition=" '$(_NTROOT)' == '' ">
    <SchemaVersion>2.0</SchemaVersion>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>AtlasDev.ExtensionsScript</RootNamespace>
    <AssemblyName>AtlasDev.ExtensionsScript</AssemblyName>
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)' == 'Debug' ">
    <DefineConstants>TRACE;DEBUG</DefineConstants>
  </PropertyGroup>
  <!-- Need to use $(_NTROOT) to detect Razzle since $(RazzleBuild) isn't defined yet. -->
  <Import Condition=" '$(_NTROOT)' != '' " Project="$(_NTDRIVE)$(_NTROOT)\ndp\fx\Microsoft.Fx.Settings.targets" />
  <Import Condition=" '$(RazzleBuild)' != 'true' " Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />

  <!-- Custom Tasks -->
  <UsingTask Condition=" '$(RazzleBuild)' == 'true' " TaskName="ScriptTask" AssemblyFile="$(ManagedToolsPath)\nStuff.JavaScript.dll" />
  <UsingTask Condition=" '$(RazzleBuild)' == 'true' " TaskName="JSCrunch" AssemblyFile="$(ManagedToolsPath)\eStuff.JSCrunch.dll" />
  <Choose>
    <When Condition=" '$(RazzleBuild)' == 'true' ">
      <!--
  ScriptDebugDefines is a set of JavaScript defines only used in debug scripts. Release scripts
  never have anything defined. For our internal builds we define an additional DEBUGINTERNAL
  define so we can hide our asserts from customer builds.
  -->
      <PropertyGroup Condition=" '$(DebugBuild)' == 'true' ">
        <Minimize>false</Minimize>
        <StripCommentsOnly>false</StripCommentsOnly>
        <ScriptDebugDefines>DEBUG;TRACE;DEBUGINTERNAL</ScriptDebugDefines>
      </PropertyGroup>
      <PropertyGroup Condition=" '$(DebugBuild)' == 'false' ">
        <Minimize>false</Minimize>
        <StripCommentsOnly>true</StripCommentsOnly>
        <ScriptDebugDefines>DEBUG;TRACE</ScriptDebugDefines>
      </PropertyGroup>
    </When>
  </Choose>
  <!-- Sources -->
  <ItemGroup>
    <Content Include="Array.js" />
    <Content Include="Boolean.js" />
    <Content Include="Compat\Browser.js" />
    <Content Include="Date.Globalization.js" />
    <Content Include="Date.HijriCalendar.js" />
    <Content Include="Date.js" />
    <Content Include="Date.UmAlQuraCalendar.js" />
    <Content Include="Error.js" />
    <Content Include="ExtensionsScript.csproj" />
    <Content Include="Function.js" />
    <Content Include="Sys\CollectionChange.js" />
    <Content Include="Number.Globalization.js" />
    <Content Include="Number.js" />
    <Content Include="Object.js" />
    <Content Include="RegExp.js" />
    <Content Include="String.Globalization.js" />
    <Content Include="String.js" />
    <Content Include="Sys\Application.js" />
    <Content Include="Sys\ApplicationLoadEventArgs.js" />
    <Content Include="Sys\CancelEventArgs.js" />
    <Content Include="Sys\CommandEventArgs.js" />
    <Content Include="Sys\Component.js" />
    <Content Include="Sys\Application.History.js" />
    <Content Include="Sys\CultureInfo.js" />
    <Content Include="Sys\Debug.js" />
    <Content Include="Sys\Enum.js" />
    <Content Include="Sys\EventArgs.js" />
    <Content Include="Sys\EventHandlerList.js" />
    <Content Include="Sys\HistoryEventArgs.js" />
    <Content Include="Sys\IContainer.js" />
    <Content Include="Sys\IDisposable.js" />
    <Content Include="Sys\INotifyDisposing.js" />
    <Content Include="Sys\INotifyPropertyChange.js" />
    <Content Include="Sys\NotifyCollectionChangedAction.js" />
    <Content Include="Sys\NotifyCollectionChangedEventArgs.js" />
    <Content Include="Sys\Observer.js" />
    <Content Include="Sys\Net\NetworkRequestEventArgs.js" />
    <Content Include="Sys\Net\WebRequest.js" />
    <Content Include="Sys\Net\WebRequestExecutor.js" />
    <Content Include="Sys\Net\WebRequestManager.js" />
    <Content Include="Sys\Net\WebServiceError.js" />
    <Content Include="Sys\Net\WebServiceProxy.js" />
    <Content Include="Sys\Net\XMLHttpExecutor.js" />
    <Content Include="Sys\PropertyChangedEventArgs.js" />
    <Content Include="Sys\ScriptLoader.js" />
    <Content Include="Sys\ScriptLoaderTask.js" />
    <Content Include="Sys\Serialization\JavaScriptSerializer.js" />
    <Content Include="Sys\Services\AuthenticationService.js" />
    <Content Include="Sys\Services\ProfileService.js" />
    <Content Include="Sys\Services\RoleService.js" />
    <Content Include="Sys\StringBuilder.js" />
    <Content Include="Sys\UI\Behavior.js" />
    <Content Include="Sys\UI\Bounds.js" />
    <Content Include="Sys\UI\Control.js" />
    <Content Include="Sys\UI\Controls\PermaLink.js" />
    <Content Include="Sys\UI\Controls\Timer.js" />
    <Content Include="Sys\UI\Controls\UpdateProgress.js" />
    <Content Include="Sys\UI\DomElement.js" />
    <Content Include="Sys\UI\DomEvent.js" />
    <Content Include="Sys\UI\Key.js" />
    <Content Include="Sys\UI\MouseButton.js" />
    <Content Include="Sys\UI\Point.js" />
    <Content Include="Sys\UI\VisibilityMode.js" />
    <Content Include="Sys\WebForms\BeginRequestEventArgs.js" />
    <Content Include="Sys\WebForms\EndRequestEventArgs.js" />
    <Content Include="Sys\WebForms\InitializeRequestEventArgs.js" />
    <Content Include="Sys\WebForms\PageLoadedEventArgs.js" />
    <Content Include="Sys\WebForms\PageLoadingEventArgs.js" />
    <Content Include="Sys\WebForms\PageRequestManager.js" />
    <Content Include="Sys\XMLHttpRequest.js" />
    <Content Include="Type.js" />
  </ItemGroup>
  <ItemGroup Condition=" '$(RazzleBuild)' == 'true' ">
    <Compile Include="MicrosoftAjax.jsa" />
    <Compile Include="MicrosoftAjaxApplicationServices.jsa" />
    <Compile Include="MicrosoftAjaxComponentModel.jsa" />
    <Compile Include="MicrosoftAjaxCore.jsa" />
    <Compile Include="MicrosoftAjaxGlobalization.jsa" />
    <Compile Include="MicrosoftAjaxHistory.jsa" />
    <Compile Include="MicrosoftAjaxNetwork.jsa" />
    <Compile Include="MicrosoftAjaxSerialization.jsa" />
    <Compile Include="MicrosoftAjaxTimer.jsa" />
    <Compile Include="MicrosoftAjaxWebForms.jsa" />
    <Compile Include="MicrosoftAjaxWebServices.jsa" />
    <Compile Include="Date.HijriCalendar.jsa" />
    <Compile Include="Date.UmAlQuraCalendar.jsa" />
  </ItemGroup>
  <ItemGroup Condition=" '$(RazzleBuild)' != 'true' ">
    <None Include="makefile" />
    <None Include="MicrosoftAjax.jsa" />
    <None Include="MicrosoftAjaxApplicationServices.jsa" />
    <None Include="MicrosoftAjaxComponentModel.jsa" />
    <None Include="MicrosoftAjaxCore.jsa" />
    <None Include="MicrosoftAjaxGlobalization.jsa" />
    <None Include="MicrosoftAjaxHistory.jsa" />
    <None Include="MicrosoftAjaxNetwork.jsa" />
    <None Include="MicrosoftAjaxSerialization.jsa" />
    <None Include="MicrosoftAjaxTimer.jsa" />
    <None Include="MicrosoftAjaxWebForms.jsa" />
    <None Include="MicrosoftAjaxWebServices.jsa" />
    <None Include="Date.HijriCalendar.jsa" />
    <None Include="Date.UmAlQuraCalendar.jsa" />
    <None Include="sources" />
  </ItemGroup>
  <ItemGroup Condition=" '$(RazzleBuild)' != 'true' ">
    <Service Include="{B4F97281-0DBD-4835-9ED8-7DFB966E87FF}" />
  </ItemGroup>
  <ItemGroup Condition=" '$(RazzleBuild)' == 'true' ">
    <DebugScripts Include="@(Compile -> '$(OutputPath)\%(filename).debug.js')" />
    <ReleaseScripts Include="@(Compile -> '$(OutputPath)\%(filename).js')" />
    <DocScripts Include="@(Compile -> '$(OutputPath)\%(filename).vsdoc.js')" />
  </ItemGroup>
  <!-- Targets -->
  <!--
  To work correctly with the DevDiv build process, the targets must be named "BuildGenerated", "BuildCompiled", and "BuildLinked"
  -->
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="BuildGenerated" Inputs="@(Compile);@(Content)" Outputs="@(DebugScripts);@(ReleaseScripts)">
  </Target>
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="BuildCompiled">
    <!--
    If the output directory does not exist, ScriptTask will generate an error instead of creating it automatically.
    So we must manually create the output directory first.  Alternatively, we could change ScriptTask to automatically
    create the output directory.
    -->
    <MakeDir Directories="$(OutputPath)" />
    <!-- Debug Build -->
    <ScriptTask Debug="true" Minimize="$(Minimize)" StripCommentsOnly="$(StripCommentsOnly)" WindowsLineBreaks="true" Defines="$(ScriptDebugDefines)" NoLogo="true" Sources="@(Compile)" OutputDirectory="$(OutputPath)" />
    <Copy SourceFiles="@(ReleaseScripts)" DestinationFiles="@(DebugScripts)" />
    <!-- VSDoc Build -->
    <ScriptTask Debug="true" Minimize="$(Minimize)" StripCommentsOnly="$(StripCommentsOnly)" WindowsLineBreaks="true" Defines="$(ScriptDebugDefines)" NoLogo="true" Sources="@(Compile)" OutputDirectory="$(OutputPath)" IncludeParameterValidation="false" />
    <Copy SourceFiles="@(ReleaseScripts)" DestinationFiles="@(DocScripts)" />
    <!-- Remove Javascript comments from debug scripts -->
    <Message Text="Removing javascript comments from debug scripts" />
    <Exec Command="RemoveJsComments.exe @(DebugScripts, ' ')" />
    <!-- Remove Javascript comments from doc scripts -->
    <Message Text="Removing javascript comments from doc scripts" />
    <Exec Command="RemoveJsComments.exe @(DocScripts, ' ')" />
    <!-- Release Build -->
    <ScriptTask Debug="false" Minimize="true" StripCommentsOnly="false" WindowsLineBreaks="false" Defines="" NoLogo="true" Sources="@(Compile)" OutputDirectory="$(OutputPath)" />
    <JSCrunch SourceFiles="@(ReleaseScripts)" />
  </Target>
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="BuildLinked" />
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="Clean">
    <Delete Files="@(DebugScripts);@(ReleaseScripts)" />
  </Target>
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="Build" DependsOnTargets="BuildGenerated;BuildCompiled;BuildLinked" />
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="Rebuild" DependsOnTargets="Clean;Build" />
  <Target Condition=" '$(RazzleBuild)' == 'true' " Name="GetNativeManifest">
    <!-- HACH: Need this target to allow building System.Web.Extensions from command line -->
  </Target>
  <!--
  <Target Name="CodeCov" Condition="'$(CodeCov)'=='script' or '$(CodeCov)'=='all'">
    <Exec Command="$(AtlasCommonToolsPath)\jscriptcodecov-start.cmd" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjax.js 0 MicrosoftAjax.js MicrosoftAjax.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxWebForms.js 3 MicrosoftAjaxWebForms.js MicrosoftAjaxWebForms.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxTimer.js 4 MicrosoftAjaxTimer.js MicrosoftAjaxTimer.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxTemplates.js 4 MicrosoftAjaxTemplates.js MicrosoftAjaxTemplates.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxAdoNet.js 4 MicrosoftAjaxAdoNet.js MicrosoftAjaxAdoNet.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxCore.js 4 MicrosoftAjaxCore.js MicrosoftAjaxCore.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxComponentModel.js 4 MicrosoftAjaxComponentModel.js MicrosoftAjaxComponentModel.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxDataContext.js 4 MicrosoftAjaxDataContext.js MicrosoftAjaxDataContext.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxHistory.js 4 MicrosoftAjaxHistory.js MicrosoftAjaxHistory.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxApplicationServices.js 4 MicrosoftAjaxApplicationServices.js MicrosoftAjaxApplicationServices.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxWebServices.js 4 MicrosoftAjaxWebServices.js MicrosoftAjaxWebServices.js" WorkingDirectory="$(DebugOutputDirectory)" />
    <Exec Command="$(AtlasCommonToolsPath)\JScriptCleaner.exe MicrosoftAjaxNetwork.js 4 MicrosoftAjaxNetwork.js MicrosoftAjaxNetwork.js" WorkingDirectory="$(DebugOutputDirectory)" />
  </Target>
  -->
</Project>